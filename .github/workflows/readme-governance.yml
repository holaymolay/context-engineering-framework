name: README governance

on:
  push:
    branches:
      - main
      - master
  pull_request:
    paths:
      - "README.md"
      - "README_SPEC.yaml"
      - ".github/workflows/readme-governance.yml"
      - "scripts/readme_lint_autofix.py"

jobs:
  readme-governance:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Ensure README_SPEC exists
        run: |
          if [ ! -f README_SPEC.yaml ]; then
            echo "README_SPEC.yaml is required for spec-driven README generation."
            exit 1
          fi
      - name: Install readme-spec-engine (generator remains external)
        run: pip install git+https://github.com/holaymolay/readme-spec-engine.git
      - name: Validate README against spec (no generation in CI)
        run: |
          # Generation is intentionally excluded in CI to keep the workflow deterministic.
          # This step only validates that the committed README matches the committed spec.
          readme-spec-engine validate --spec README_SPEC.yaml --readme README.md
      - name: Enforce README narrative and structure
        run: python scripts/readme_lint_autofix.py --check
